<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lato"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css">
<link rel="icon" href="/img/cropped-favicon-1-32x32.png">

<link href="/css/froala_style.min.css" rel="stylesheet" type="text/css" />

<link rel="stylesheet" href="/css/timeline.css">

<title>Timeline</title>
</head>

<body>

	<nav class="navbar navbar-expand-lg sticky-top" style="background-color:white;">
		
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbar" aria-controls="navbarNavAltMarkup"
			aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon">
			<a href="/" class="navbar-brand"><img
			src="/img/logo-mediacenter-bgwhite.png" alt="Logo Media Center"
			style="width: 210px"></a>
			</span>
		</button>
		<a th:if="${usuario} == null" href="/usuarios/login"
			class="btn btn-outline-default" th:text="#{login}"></a> <a
			th:if="${usuario}" href="/logout"><button
				class="btn btn-danger btn-sm" th:text="#{sair}"></button></a>
		<div class="collapse navbar-collapse" id="navbar">
			<form class="form-inline my-2  ml-auto my-lg-0">
				<th:block th:if="${usuario}">
					<a th:if="${usuario.tipo.toString()} == ESTAGIARIO"
						class="nav-link btn-outline-success" href="/sugestoes/dashboard"
						th:text="#{dashboard}"></a>
					<a th:if="${usuario.tipo.toString()} == ADMINISTRADOR"
						class="nav-link btn-outline-defaul" href="/sugestoes/dashboard"
						th:text="#{dashboard}"></a>
				</th:block>
				&nbsp
				<div class="dropdown">
					<button class="btn btn-outline-default dropdown-toggle"
						type="button" id="dropdownMenuButton" data-toggle="dropdown"
						aria-haspopup="true" aria-expanded="false">
						<i style="vertical-align: middle;">Idioma</i>
					</button>
					<div class="dropdown-menu text-uppercase"
						aria-labelledby="dropdownMenuButton">
						<a class="dropdown-item" th:text="#{lang.eng}" href="?lang=en"></a>
						<a class="dropdown-item" th:text="#{lang.es}" href="?lang=es"></a>
						<a class="dropdown-item" th:text="#{lang.pt}" href="?lang=pt"></a>
					</div>
				</div>
				&nbsp <input style="color: black;" class="form-control mr-sm-2"
					type="search" th:placeholder="#{pesquisar}" aria-label="Search"
					id="valorPesquisa">
				<button class="btn btn-outline-default my-2 my-sm-0" type="submit"
					th:text="#{pesquisar}" id="pesquisar"></button>
			</form>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row profile">					
			<div class="col-lg-12 m-auto col-sm-12 col-md-12">
				<!--tabs-->
				<nav>
					<div class="nav nav-tabs" id="nav-tab" role="tablist">
						<a href="#recentes" id="nav-recentes-tab"
							class="nav-item nav-link active" data-toggle="tab"
							aria-controls="recentes" th:text="#{mais-recentes}"></a> <a
							href="#lidas" id="nav-lidas-tab" class="nav-item nav-link"
							data-toggle="tab" aria-controls="lidas" th:text="#{mais-lidas}">
						</a> <a href="#tags" id="nav-tags-tab" class="nav-item nav-link"
							data-toggle="tab" aria-controls="nav-tags"
							th:text="#{busca-por-tag}"></a>
					</div>
				</nav>
				<div class="tab-content" id="nav-tabContent">
					<!--Mais recentes-->
					<div class="tab-pane fade show active" id="recentes"
						role="tabpanel" aria-labelledby="nav-recentes-tab">
						<div class="container">
							<div class="row">
								<div class="col-sm-12 col-lg-12"
									th:each="conteudo : ${maisRecentes}">
									<div class="card mt-4">
										<div class="card-header">
											<a class="card-link"
												th:href="@{/conteudos/} + ${conteudo.id}">
												<h5 class="card-title mb-4" th:text="${conteudo.titulo}"></h5>
											</a> <small class="text-muted"
												th:text="${conteudo.getFormatedData()}"></small>
										</div>
										<div class="card-body">
											<p class="card-text" th:text="${conteudo.descricao}"></p>
											<div class="content fr-view" th:utext="${conteudo.conteudo}"></div>
											<div class="post-tags mt-2">
												<th:block th:each="tag : ${conteudo.tags}">
													<span th:text="${tag.nome}" class="btn btn-secondary"></span>
												</th:block>
											</div>
										</div>
										<div class="card-footer" th:if="${usuario}">
											<div class="row">
												<div class="col-4 feedback-positivo">
													<button type="button" th:id="${conteudo.id}"
														class="atribuirConteudo enviar-feedback-positivo btn btn-secondary bmd-btn"
														style="width: 100%">
														<i class="material-icons icon">thumb_up</i>
														<th:block th:text="#{gostei}"></th:block>
													</button>
												</div>
												<div class="col-4 feedback-negativo">
													<button type="button" th:id="${conteudo.id}"
														class="atribuirConteudo enviar-feedback-negativo btn btn-secondary bmd-btn"
														style="width: 100%">
														<i class="material-icons icon">thumb_down</i>
														<th:block th:text="#{nao-gostei}"></th:block>
													</button>
												</div>
												<div class="col-4">
													<button th:id="${conteudo.id}" type="button"
														class="atribuirConteudo btn btn-secondary bmd-btn"
														style="width: 100%" data-toggle="modal"
														data-target="#tag-modal">
														<i class="material-icons icon">comment</i>
														<th:block th:text="#{sugerir-tag}"></th:block>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!--Mais lidas-->
					<div class="tab-pane fade" id="lidas" role="tabpanel"
						aria-labelledby="nav-lidas-tab">
						<div class="container">
							<div class="row">
								<div class="col-sm-12 col-lg-12"
									th:each="conteudo : ${maisLidas}">
									<div class="card mt-4">
										<div class="card-header">
											<a class="card-link"
												th:href="@{/conteudos/} + ${conteudo.id}">
												<h5 class="card-title mb-4" th:text="${conteudo.titulo}"></h5>
											</a> <small class="text-muted"
												th:text="${conteudo.getFormatedData()}"></small>
										</div>
										<div class="card-body">
											<p class="card-text" th:text="${conteudo.descricao}"></p>
											<div class="content fr-view" th:utext="${conteudo.conteudo}"></div>
											<div class="post-tags mt-2">
												<th:block th:each="tag : ${conteudo.tags}">
													<span th:text="${tag.nome}" class="badge badge-primary"></span>
												</th:block>
											</div>
										</div>
										<div class="card-footer" th:if="${usuario}">
											<div class="row">
												<div class="col-4 feedback-positivo">
													<button type="button" th:id="${conteudo.id}"
														class="atribuirConteudo enviar-feedback-positivo btn btn-secondary bmd-btn"
														style="width: 100%">
														<i class="material-icons icon">thumb_up</i>
														<th:block th:text="#{gostei}"></th:block>
													</button>
												</div>
												<div class="col-4 feedback-negativo">
													<button type="button" th:id="${conteudo.id}"
														class="atribuirConteudo enviar-feedback-negativo btn btn-secondary bmd-btn"
														style="width: 100%">
														<i class="material-icons icon">thumb_down</i>
														<th:block th:text="#{nao-gostei}"></th:block>
													</button>
												</div>
												<div class="col-4">
													<button type="button" th:id="${conteudo.id}"
														class="atribuirConteudo btn btn-secondary bmd-btn"
														style="width: 100%" data-toggle="modal"
														data-target="#tag-modal">
														<i class="material-icons icon">comment</i>
														<th:block th:text="#{sugerir-tag}"></th:block>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!--Busca por tags-->
					<div class="tab-pane fade" id="tags" role="tabpanel"
						aria-labelledby="nav-tags-tab">
						<button id="Esportes" type="button"
							class="btn btn-primary categoria">
							Esportes <span aria-hidden="true">&times;</span>
						</button>
						<button id="Cultura" type="button" class="btn btn-primary categoria">
							Cultura <span aria-hidden="true">&times;</span>
						</button>
						<button id="Tecnologia" type="button" class="btn btn-primary categoria">
							Tecnologia <span aria-hidden="true">&times;</span>
						</button>
						<button id="Musica" type="button" class="btn btn-primary categoria">
							Música <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary categoria">
							Estudo <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary categoria">
							Saúde <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary categoria">
							Streams <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary categoria">
							Jogos <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary">
							Política <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary">
							Religião <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary">
							Finanças <span aria-hidden="true">&times;</span>
						</button>
						<button type="button" class="btn btn-primary">
							Psicologia <span aria-hidden="true">&times;</span>
						</button>

					</div>
				</div>
			</div>
		</div>


	</div>

	<div class="modal fade" id="tag-modal" tabindex="-1" role="dialog"
		aria-labelledby="tag-modal" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel"
						th:text="#{sugerir-tag}"></h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form>
						<div class="form-group">
							<label for="sugestao" th:text="#{digite-tags}"></label> <input
								type="text" name="sugestao" id="sugestao" class="form-control">
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal" th:text="#{fechar}">Fechar</button>
					<button type="button" class="btn btn-primary enviar-sugestao">Enviar</button>
				</div>
			</div>
		</div>
	</div>




	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"></script>
	<script
		src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"></script>
	<script>
		$(document).ready(function() {
			$('body').bootstrapMaterialDesign();
		});
	</script>	
	<script type="text/javascript">
	$(document).ready(function() {		
		//pesquisa por categoria
		$('.categoria').click(function(){
			event.preventDefault();				
			window.location.assign('timeline/categoria?categoria=' + $(this).attr('id'));				
		});
		
		
		//pesquisa por conteudo
		$('#pesquisar').click(function(){
			event.preventDefault();				
			window.location.assign('timeline/descricao?descricao=' + $('#valorPesquisa').val());
			console.log("entrou no procurar"+$('#valorPesquisa').val());
		});
		
		$('.atribuirConteudo').click(function() {
			console.log("Entrou no click do atribuirConteudo. Conteudo atual: " + conteudo);
			conteudo = this.id;
			console.log("Como o conteudo está apoós a tranformação do click do atribuirConteudo: "+ conteudo);
		});

		$('.enviar-sugestao').click(function() {
			var sugestao = $('#sugestao').val();
			$.post(`/sugestoes?usuario=${usuario}&sugestao=${sugestao}&conteudo=${conteudo}`,function(data, status) {
				$('#tag-modal').modal('hide')
			});
		});
		
		$('.enviar-feedback-positivo').click(function() {
			var botao = this;
			var botaoContrario = $(this).parent().parent().children('.feedback-negativo').children();
			$.post(`/feedbacks/positivo?usuario=${usuario}&conteudo=${conteudo}`,function(data, status) {
				console.log("Id do botão clicado : " + botao.id);
				$(botao).children('.icon').css("color", "#353c86")
				botaoContrario.children('.icon').css("color", "#6c757d")
			});
		});
		
		$('.enviar-feedback-negativo').click(function() {
			var botao = this;
			var botaoContrario = $(this).parent().parent().children('.feedback-positivo').children();
			$.post(`/feedbacks/negativo?usuario=${usuario}&conteudo=${conteudo}`,function(data, status) {
				console.log("Id do botão clicado : " + botao.id);
				$(botao).children('.icon').css("color", "#353c86");
				botaoContrario.children('.icon').css("color", "#6c757d")
			});
		});
		if(usuario.length > 0){
			$.get(`/feedbacks/positivo/usuario/?usuario=${usuario}`,function(data, status) {
				console.log("Entrou no histórico de feedbacks positivos")
				var feedbacks = data;
				$('.enviar-feedback-positivo').each(function(index){
					if(feedbacks.includes(this.id)){
						$(this).children('.icon').css("color", "#353c86");
					}
				});
			});
			$.get(`/feedbacks/negativo/usuario/?usuario=${usuario}`,function(data, status) {
				console.log("Entrou no histórico de feedbacks negativos")
				var feedbacks = data;
				$('.enviar-feedback-negativo').each(function(index){
					if(feedbacks.includes(this.id)){
						$(this).children('.icon').css("color", "#353c86");
					}
				});
			});
		}
	});
</script>	
</body>
</html>